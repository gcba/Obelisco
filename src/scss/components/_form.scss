/* === Variable and mixins overides === */

$input-bg: $light;
$custom-select-bg: $input-bg;
$input-placeholder-color: $grisulado-300;

$input-disabled-color: $grisulado-300;
$input-disabled-bg: $grisulado-10;

$label-margin-bottom: 0;

$input-border-color: $grisulado-50;
$input-border-width: 2px;
$input-box-shadow: 0 0 0 $input-border-width $input-border-color;

$input-height: 44px;
$input-border-radius: $border-radius-lg;

$custom-select-height: $input-height;
$custom-select-disabled-color: $input-disabled-color;
$custom-select-disabled-bg: $input-disabled-bg;

$input-focus-border-color: $input-disabled-color;
$input-focus-box-shadow: $focus-box-shadow;

$input-height-sm: 44px;

$custom-control-indicator-checked-color: $blue;
$custom-control-indicator-active-color: $blue;
$custom-control-indicator-size: spaceUnits(5);
$custom-control-indicator-bg: transparent;
$custom-control-indicator-border-color: $grisulado-900;
$custom-control-indicator-border-width: 2px;
$custom-control-indicator-checked-bg: $blue;
$custom-control-indicator-checked-border-color: $blue;
$custom-control-indicator-focus-border-color: $grisulado-900;
$custom-control-indicator-active-bg: $blue;
$custom-control-indicator-active-border-color: $blue;
$custom-control-indicator-checked-disabled-bg: transparent;
$custom-control-indicator-disabled-bg: transparent;

$custom-checkbox-indicator-icon-checked: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" style="&%2310;"><rect x="1" y="1" width="22" height="22" rx="2" fill="" stroke="" stroke-width="2" style="&%2310;"/><path d="M9.1725 16.1625L5.7025 12.6925C5.3125 12.3025 4.6825 12.3025 4.2925 12.6925C3.9025 13.0825 3.9025 13.7125 4.2925 14.1025L8.4725 18.2825C8.8625 18.6725 9.4925 18.6725 9.8825 18.2825L20.4625 7.7025C20.8525 7.3125 20.8525 6.6825 20.4625 6.2925C20.0725 5.9025 19.4425 5.9025 19.0525 6.2925L9.1725 16.1625Z" fill="white"/></svg>');

$input-validation-focus-width: $input-border-width;

$form-text-margin-top: 0;
$form-text-margin-bottom: spaceUnits(1);

$form-icons: (
  'search':
    url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(56, 72, 92, 1);transform: ;msFilter:;"><path d="M10 18a7.952 7.952 0 0 0 4.897-1.688l4.396 4.396 1.414-1.414-4.396-4.396A7.952 7.952 0 0 0 18 10c0-4.411-3.589-8-8-8s-8 3.589-8 8 3.589 8 8 8zm0-14c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6z"></path></svg>'),
  'valid':
    url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" style="fill: rgba(38, 135, 74, 1);transform: ;msFilter:;"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm-1.999 14.413-3.713-3.705L7.7 11.292l2.299 2.295 5.294-5.294 1.414 1.414-6.706 6.706z"></path></svg>'),
  'invalid':
    url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" style="fill: rgba(201, 59, 59, 1);transform: ;msFilter:;"><path d="M11.953 2C6.465 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.493 2 11.953 2zM13 17h-2v-2h2v2zm0-4h-2V7h2v6z"></path></svg>')
);
$form-search-button-reset: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="rgb(56, 72, 92)"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M18.3 5.71c-.39-.39-1.02-.39-1.41 0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"/></svg>');

$form-search-reset-bar: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="1" height="24" viewBox="0 0 1 24" fill="none"><rect y="0.5" width="1" height="23" fill="%239EAAB8"/></svg>');

// Some configuration is inside ../_colors.scs

$form-validation-states: (
  'valid': (
    'color': $form-feedback-valid-color,
    'icon': none
  ),
  'invalid': (
    'color': $form-feedback-invalid-color,
    'icon': none
  )
);

/* === Custom variables and mixins === */

$custom-control-focus-color: #005387;
%custom-checkbox-size-position {
  width: 1.5rem;
  height: 1.5rem;
  top: 8px;
  left: 8px;
}

/* === Bootstrap Import === */

@import 'node_modules/bootstrap/scss/forms';
@import 'node_modules/bootstrap/scss/custom-forms';

/* === Custom styles === */

.form-search {
  height: $input-height;

  &-sm {
    height: $input-height-sm;
  }
  
  .form-group {
    position: relative;
  }
}

.form-group {
  &:has(.input-search, input[type='search']) {
    position: relative;
  }

  label {
    @extend .h5;
    margin-bottom: $label-margin-bottom;
  }

  &.disabled {
    label,
    .form-control,
    .reset {
      color: $input-disabled-color;
      pointer-events: none;
    }
  }

  .input-search,
  input[type='search'] {
    padding-right: 4.2rem;
  }

  .input-search,
  input[type='search'],
  .reset {
    vertical-align: middle;
  }

  .reset {
    display: block;
    cursor: pointer;
    outline: 0.125rem solid transparent;
    outline-offset: -2px;

    &::after {
      content: '';
      position: relative;
      left: 15px;
      top: 50%;
      transform: translate(0, -50%);
      display: inline-block;
      height: 100%;
      width: 1px;
      min-width: 1px;
      background: transparent $form-search-reset-bar no-repeat center center;
    }

    &:focus,
    &:focus-visible {
      box-shadow: 0 0 0 0.25rem #00568b;
      border-radius: 0.5rem;
      outline: 0.25rem solid transparent;

      &::after {
        color: transparent;
        background-image: none;
      }
    }
  }

}

.custom-control-label {
  padding: spaceUnits(1);
  padding-left: $custom-control-indicator-size + spaceUnits(5);
  padding-right: spaceUnits(3);
  margin-bottom: spaceUnits(2);
  border-radius: $border-radius * 2;

  &::before {
    left: spaceUnits(3);
    top: spaceUnits(1.5);
  }

  &::after {
    left: spaceUnits(3);
    top: spaceUnits(1.5);
  }
}

@mixin form-icon($type) {
  background-image: map-get($form-icons, $type);
  background-repeat: no-repeat;
  background-position: center right spaceUnits(2);
}

.form-control,
.custom-select {
  transition: none;
  border: none;
  border-radius: $border-radius-lg;
  box-shadow: $input-box-shadow;
  outline: 0.125rem solid transparent;
  margin: $input-border-width;
  width: calc(100% - #{$input-border-width * 2});

  &:focus {
    background-color: $input-bg;
    box-shadow: $input-focus-box-shadow;
    outline: 0.25rem solid transparent;
  }

  &.input-search {
    @include form-icon('search');

    &[type='search']::-webkit-search-cancel-button {
      display: none;
    }

    &[type='search']:invalid ~ .reset[type='reset'] {
      display: none;
    }

    &[type='search']:placeholder-shown {
      ~ .reset {
        display: none;
      }
    }

    &[type='search'] ~ .reset[type='reset'] {
      border: none;
      position: absolute;
      background: transparent $form-search-button-reset no-repeat center center;
      right: 42px;
      top: 50%;
      transform: translate(0, -50%);
      height: 2.5rem;
      width: 1.5rem;
      min-width: 1.5rem;
    }
  }

  &.is-valid,
  &.is-invalid {
    border: none;

    &:focus {
      box-shadow: 0 0 0 $focus-width $focus-color;
    }
  }

  &.is-valid {
    box-shadow: 0 0 0 $input-validation-focus-width $success;
  }

  &.is-invalid {
    box-shadow: 0 0 0 $input-validation-focus-width $danger;
  }

  &:disabled,
  &[readonly] {
    color: $input-disabled-color;
    pointer-events: none;
  }
}

.form-text {
  margin-bottom: $form-text-margin-bottom;
}

.valid-feedback,
.invalid-feedback {
  margin-top: spaceUnits(2);
}

.valid-feedback::before {
  content: map-get($form-icons, 'valid');
  vertical-align: middle;
  margin-right: spaceUnits(1);
}

.invalid-feedback::before {
  content: map-get($form-icons, 'invalid');
  vertical-align: middle;
  margin-right: spaceUnits(1);
}

// Custom controls

.custom-control {
  padding-left: 0;

  .custom-control-input.is-invalid {
    ~ .custom-control-label {
      color: inherit;
    }

    &:checked {
      ~ .custom-control-label::before {
        border-color: $custom-control-indicator-checked-color;
      }
    }
  }

  &.custom-checkbox {
    .custom-control-input.is-invalid:checked ~ .custom-control-label::before {
      background: $custom-control-indicator-checked-color;
    }

    .custom-control-label {
      padding: 8px 4px 8px 40px;
      min-height: 40px;
      margin-bottom: 0;
    
      &::before {
        @extend %custom-checkbox-size-position;
      }
      &::after {
        @extend %custom-checkbox-size-position;
        background-size: auto;
      }
      &.no-text {
        padding: 8px 4px 8px 36px;
      }
    }

    .custom-control-input {    
      @extend %custom-checkbox-size-position;
      &:not(:disabled):focus ~ .custom-control-label {
        box-shadow: 0 0 0 4px $custom-control-focus-color;
        outline: 0.25rem solid transparent;
        &:before {
          box-shadow: none;
          outline: none;
        }
      }

      &:not(:disabled):hover ~ .custom-control-label {
        text-decoration-thickness: 1px;
      }

      &:disabled  ~ .custom-control-label {
        &:before {
          background-color: $input-disabled-color;
        }
      }

      &:checked:hover  ~ .custom-control-label {
        color: $custom-control-focus-color;
        text-decoration: none;
        &:before {
          background-color: $custom-control-focus-color;
          border-color: $custom-control-focus-color;
        }
      }
    }
  }
}

.custom-control-input {
  &:not(:disabled) ~ .custom-control-label {
    cursor: pointer;

    &:hover {
      color: $custom-control-indicator-active-color;
      text-decoration: underline;

      &:before {
        border-color: $custom-control-indicator-active-color;
      }
    }
  }

  &:not(:disabled):focus ~ .custom-control-label {
    &:before {
      box-shadow: 0 0 0 7px #005386;
      outline: 3px solid $white;
    }
  }

  &:disabled ~ .custom-control-label {
    color: $custom-select-disabled-color;
    pointer-events: none;

    &:before {
      border-color: $input-disabled-color;
    }
  }
}

// Radios
.custom-radio {
  .custom-control-input:checked ~ .custom-control-label {
    &:before {
      box-shadow: inset 0 0 0 3.4px $white;
      background-color: $custom-control-indicator-checked-color;
      outline: 3px solid transparent;
      outline-offset: -8px;
    }

    &:after {
      background-image: none;
    }
  }

  .custom-control-input:checked:not(:disabled):focus ~ .custom-control-label:before {
    box-shadow: 0 0 0 7px #005386, inset 0 0 0 3.4px $white;
    outline: 3px solid $white;
    background-color: $custom-control-indicator-checked-color;
    outline-offset: -8px;
  }
}

.bg-light {
  .form-control,
  .custom-select {
    &:not(:disabled) {
      background-color: $white;
    }
  }
}

// Checkbox button
.btn-chip {
  font-weight: normal;
  background-color: $grisulado-10;

  @include btn-disabled;

  @include hover() {
    background-color: $grisulado-10;
    color: $link-color;
    box-shadow: 0 0 0 $btn-hover-width $blue;
  }

  &:focus,
  &.focus {
    box-shadow: 0 0 0 $input-btn-focus-width $box-shadow-button;
    text-decoration: none;
    outline: 0.25rem solid transparent;
  }

  &.active {
    color: #fff;
    background-color: $blue;
    box-shadow: none;
    outline: 0.25rem solid transparent;
    outline-offset: -4px;

    &:hover {
      color: #fff;
      box-shadow: none;
      text-decoration: none;
    }

    &:focus, &.focus {
      outline-offset: 0;
    }
  }

  &.disabled {
    &:focus, &.focus {
      outline: none;
    }
  }
}

.btn-check {
  position: absolute;
  clip: rect(0, 0, 0, 0);
  pointer-events: none;

  &:active,
  &:checked + .btn-chip {
    color: #fff;
    background-color: $blue;
    box-shadow: none;
    outline: 0.25rem solid transparent;
    outline-offset: -4px;
    
  }

  &:active, &:checked {
    &:focus + .btn-chip {
    outline-offset: 0;
    }
  }

  &:focus + .btn-chip {
    box-shadow: 0 0 0 $input-btn-focus-width $box-shadow-button;
    outline: 0.25rem solid transparent;
  }
}
